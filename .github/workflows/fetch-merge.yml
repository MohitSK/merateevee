name: Fetch and Merge Lists (Secure, Single Output)

on:
  schedule:
    # Run every 12 hours
    - cron: "0 */12 * * *"
  workflow_dispatch:

jobs:
  fetch_merge:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Fetch data from secret URLs and merge directly
        env:
          #URL1: ${{ secrets.URL_6_JIOTVPLUS }}
          #URL1: ${{ secrets.URL_4_JTV }}
          URL1: ${{ secrets.URL_8_TEA }}
          URL2: ${{ secrets.URL_2_Z5 }}
          #URL3: ${{ secrets.URL_3_SONY }}
          URL4: "https://raw.githubusercontent.com/mohitsk/merateevee/main/list1"
          URL5: "https://raw.githubusercontent.com/mohitsk/merateevee/main/oxoliv"
        run: |
          echo "Fetching and merging data..."
          echo 
          
          # Fetch from all 3 URLs and merge directly into 'mylist'
          {
            curl -sL "$URL1"
            echo ""
            curl -sL "$URL2"
            echo ""
            #curl -sL "$URL3"
            #echo ""
            curl -sL "$URL4"
            echo ""
            curl -sL "$URL5"
          } > mylist

          # Clean up: remove duplicates & empty lines
          #sort -u mylist | sed '/^$/d' > mylist.tmp && mv mylist.tmp mylist

      - name: Commit and push changes if updated
        run: |
          git config --global user.name "github-actions"
          git config --global user.email "actions@github.com"

          if [[ -n "$(git status --porcelain mylist)" ]]; then
            git add mylist
            git commit -m "Updated mylist from secret URLs [$(date)]"
            git push
          else
            echo "No changes to commit."
          fi
